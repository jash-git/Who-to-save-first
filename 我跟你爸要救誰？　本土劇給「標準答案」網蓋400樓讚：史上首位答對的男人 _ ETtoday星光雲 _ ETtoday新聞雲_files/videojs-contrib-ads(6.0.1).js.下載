!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsContribAds=t(e.videojs)}(this,function(f){"use strict";f=f&&f.hasOwnProperty("default")?f.default:f;var d=function(e,t){t.isImmediatePropagationStopped=function(){return!0},t.cancelBubble=!0,t.isPropagationStopped=function(){return!0}},u=function(e,t,n){d(0,n),e.trigger({type:t+n.type,originalEvent:n})};function i(e){var t,n,o,a,r,i,s;"playing"===e.type?(s=e,(i=this).ads.isInAdMode()&&(i.ads.isContentResuming()?i.ads._contentEnding&&u(i,"content",s):i.ads._cancelledPlay?d(0,s):u(i,"ad",s))):"ended"===e.type?(r=e,(a=this).ads.isInAdMode()?a.ads.isContentResuming()?(d(0,r),a.trigger("resumeended")):u(a,"ad",r):a.ads._contentHasEnded||u(a,"content",r)):"loadstart"===e.type||"loadeddata"===e.type||"loadedmetadata"===e.type?function(e,t){if(!("loadstart"===t.type&&!e.ads._hasThereBeenALoadStartDuringPlayerLife||"loadeddata"===t.type&&!e.ads._hasThereBeenALoadedData||"loadedmetadata"===t.type&&!e.ads._hasThereBeenALoadedMetaData))if(e.ads.inAdBreak())u(e,"ad",t);else{if(e.currentSrc()!==e.ads.contentSrc)return;u(e,"content",t)}}(this,e):"play"===e.type?(n=e,o=(t=this).ads._cancelledPlay&&!t.ads.isInAdMode(),t.ads.inAdBreak()?u(t,"ad",n):(t.ads.isContentResuming()||o)&&u(t,"content",n)):this.ads.isInAdMode()&&(this.ads.isContentResuming()?u(this,"content",e):u(this,"ad",e))}var e,t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},l="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},n={},o=(Object.freeze||Object)({default:n}),a=o&&n||o,r=void 0!==t?t:"undefined"!=typeof window?window:{};"undefined"!=typeof document?e=document:(e=r["__GLOBAL_DOCUMENT_CACHE@4"])||(e=r["__GLOBAL_DOCUMENT_CACHE@4"]=a);var c=e,p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=(function(){function u(e){this.value=e}function e(a){var r,i;function s(e,t){try{var n=a[e](t),o=n.value;o instanceof u?Promise.resolve(o.value).then(function(e){s("next",e)},function(e){s("throw",e)}):d(n.done?"return":"normal",n.value)}catch(e){d("throw",e)}}function d(e,t){switch(e){case"return":r.resolve({value:t,done:!0});break;case"throw":r.reject(t);break;default:r.resolve({value:t,done:!1})}(r=r.next)?s(r.key,r.arg):i=null}this._invoke=function(o,a){return new Promise(function(e,t){var n={key:o,arg:a,resolve:e,reject:t,next:null};i?i=i.next=n:(r=i=n,s(o,a))})},"function"!=typeof a.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(e){return this._invoke("next",e)},e.prototype.throw=function(e){return this._invoke("throw",e)},e.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),h=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},y=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},g=function(e,t){return t?encodeURIComponent(e):e},m=function(e,t,n){if(e&&e[n])for(var o=e[n],a=Object.keys(o),r=0;r<a.length;r++){t["{mediainfo."+n+"."+a[r]+"}"]=o[a[r]]}};var v={processMetadataTracks:function(t,n){for(var e=t.textTracks(),o=function(e){"metadata"===e.kind&&(t.ads.cueTextTracks.setMetadataTrackMode(e),n(t,e))},a=0;a<e.length;a++)o(e[a]);e.addEventListener("addtrack",function(e){o(e.track)})},setMetadataTrackMode:function(e){},getSupportedAdCue:function(e,t){return t},isSupportedAdCue:function(e,t){return!0},getCueId:function(e,t){return t.id}};v.processAdTrack=function(e,t,n,o){e.ads.includedCues={};for(var a=0;a<t.length;a++){var r=t[a],i=this.getSupportedAdCue(e,r);if(!this.isSupportedAdCue(e,r))return void f.log.warn("Skipping as this is not a supported ad cue.",r);var s=this.getCueId(e,r),d=r.startTime;if(c=e,void 0!==(p=s)&&c.ads.includedCues[p])return void f.log("Skipping ad already seen with ID "+s);o&&o(e,i,s,d),n(e,i,s,d),u=e,void 0!==(l=s)&&""!==l&&(u.ads.includedCues[l]=!0)}var u,l,c,p};var A=function(){function t(e){s(this,t),this.player=e}return t._getName=function(){return"Anonymous State"},t.prototype.transitionTo=function(e){var t=this.player;this.cleanup();var n=new e(t);t.ads._state=n,t.ads.debug(this.constructor._getName()+" -> "+n.constructor._getName());for(var o=arguments.length,a=Array(1<o?o-1:0),r=1;r<o;r++)a[r-1]=arguments[r];n.init.apply(n,[t].concat(a))},t.prototype.init=function(){},t.prototype.cleanup=function(){},t.prototype.onPlay=function(){},t.prototype.onPlaying=function(){},t.prototype.onEnded=function(){},t.prototype.onAdsReady=function(){f.log.warn("Unexpected adsready event")},t.prototype.onAdsError=function(){},t.prototype.onAdsCanceled=function(){},t.prototype.onAdTimeout=function(){},t.prototype.onAdStarted=function(){},t.prototype.onContentChanged=function(){},t.prototype.onContentResumed=function(){},t.prototype.onContentEnded=function(){f.log.warn("Unexpected contentended event")},t.prototype.onNoPreroll=function(){},t.prototype.onNoPostroll=function(){},t.prototype.startLinearAdMode=function(){f.log.warn("Unexpected startLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.prototype.endLinearAdMode=function(){f.log.warn("Unexpected endLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.prototype.skipLinearAdMode=function(){f.log.warn("Unexpected skipLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.prototype.isAdState=function(){throw new Error("isAdState unimplemented for "+this.constructor._getName())},t.prototype.isContentResuming=function(){return!1},t.prototype.inAdBreak=function(){return!1},t.prototype.handleEvent=function(e){var t=this.player;"play"===e?this.onPlay(t):"adsready"===e?this.onAdsReady(t):"adserror"===e?this.onAdsError(t):"adscanceled"===e?this.onAdsCanceled(t):"adtimeout"===e?this.onAdTimeout(t):"ads-ad-started"===e?this.onAdStarted(t):"contentchanged"===e?this.onContentChanged(t):"contentresumed"===e?this.onContentResumed(t):"contentended"===e?this.onContentEnded(t):"playing"===e?this.onPlaying(t):"ended"===e?this.onEnded(t):"nopreroll"===e?this.onNoPreroll(t):"nopostroll"===e&&this.onNoPostroll(t)},t}(),_=function(n){function o(e){s(this,o);var t=y(this,n.call(this,e));return t.contentResuming=!1,t}return h(o,n),o.prototype.isAdState=function(){return!0},o.prototype.onPlaying=function(){this.contentResuming&&this.transitionTo(R)},o.prototype.onContentResumed=function(){this.contentResuming&&this.transitionTo(R)},o.prototype.isContentResuming=function(){return this.contentResuming},o.prototype.inAdBreak=function(){return!0===this.player.ads._inLinearAdMode},o}(A),T=function(e){function t(){return s(this,t),y(this,e.apply(this,arguments))}return h(t,e),t.prototype.isAdState=function(){return!1},t.prototype.onContentChanged=function(e){e.ads.debug("Received contentchanged event (ContentState)"),e.paused()?this.transitionTo(L):(this.transitionTo(S,!1),e.pause(),e.ads._pausedOnContentupdate=!0)},t}(A);function b(e){e.ads.cancelPlayTimeout||(e.ads.cancelPlayTimeout=e.setTimeout(function(){e.ads.cancelPlayTimeout=null,e.ads.isInAdMode()&&(e.paused()||e.pause(),e.ads._cancelledPlay=!0)},1))}var k={start:function(e){e.ads.debug("Starting ad break"),e.ads._inLinearAdMode=!0,e.trigger("adstart"),e.ads.shouldPlayContentBehindAd(e)||(e.ads.snapshot=function(e){var t=void 0;t=f.browser.IS_IOS&&e.ads.isLive(e)&&0<e.seekable().length?e.currentTime()-e.seekable().end(0):e.currentTime();var n=e.$(".vjs-tech"),o=e.textTracks?e.textTracks():[],a=[],r={ended:e.ended(),currentSrc:e.currentSrc(),src:e.tech_.src(),currentTime:t,type:e.currentType()};n&&(r.nativePoster=n.poster,r.style=n.getAttribute("style"));for(var i=0;i<o.length;i++){var s=o[i];a.push({track:s,mode:s.mode}),s.mode="disabled"}return r.suppressedTracks=a,r}(e)),e.ads.shouldPlayContentBehindAd(e)&&(e.ads.preAdVolume_=e.volume(),e.volume(0)),e.addClass("vjs-ad-playing"),e.hasClass("vjs-live")&&e.removeClass("vjs-live"),e.ads.removeNativePoster()},end:function(e,t){e.ads.debug("Ending ad break"),void 0===t&&(t=function(){}),e.ads.adType=null,e.ads._inLinearAdMode=!1,e.trigger("adend"),e.removeClass("vjs-ad-playing"),e.ads.isLive(e)&&e.addClass("vjs-live"),e.ads.shouldPlayContentBehindAd(e)?(e.volume(e.ads.preAdVolume_),t()):function(t,n,e){if(void 0===e&&(e=function(){}),!0===t.ads.disableNextSnapshotRestore)return t.ads.disableNextSnapshotRestore=!1,e();var o=t.$(".vjs-tech"),a=20,r=n.suppressedTracks,i=void 0,s=function(){for(var e=0;e<r.length;e++)(i=r[e]).track.mode=i.mode},d=function(){var e=void 0;f.browser.IS_IOS&&t.ads.isLive(t)?n.currentTime<0&&(e=0<t.seekable().length?t.seekable().end(0)+n.currentTime:t.currentTime(),t.currentTime(e)):n.ended?t.currentTime(t.duration()):(t.currentTime(n.currentTime),t.play()),t.ads.shouldRemoveAutoplay_&&(t.autoplay(!1),t.ads.shouldRemoveAutoplay_=!1)},u=function e(){if(t.off("contentcanplay",e),t.ads.tryToResumeTimeout_&&(t.clearTimeout(t.ads.tryToResumeTimeout_),t.ads.tryToResumeTimeout_=null),1<(o=t.el().querySelector(".vjs-tech")).readyState)return d();if(void 0===o.seekable)return d();if(0<o.seekable.length)return d();if(a--)t.setTimeout(e,50);else try{d()}catch(e){f.log.warn("Failed to resume the content after an advertisement",e)}};n.nativePoster&&(o.poster=n.nativePoster),"style"in n&&o.setAttribute("style",n.style||""),t.ads.videoElementRecycled()?(t.one("resumeended",e),t.one("contentloadedmetadata",s),f.browser.IS_IOS&&!t.autoplay()&&(t.autoplay(!0),t.ads.shouldRemoveAutoplay_=!0),t.src({src:n.currentSrc,type:n.type}),t.one("contentcanplay",u),t.ads.tryToResumeTimeout_=t.setTimeout(u,2e3)):(s(),t.ended()||t.play(),e())}(e,e.ads.snapshot,t)}},S=function(e){function t(){return s(this,t),y(this,e.apply(this,arguments))}return h(t,e),t._getName=function(){return"Preroll"},t.prototype.init=function(e,t){e.addClass("vjs-ad-loading");var n=e.ads.settings.timeout;"number"==typeof e.ads.settings.prerollTimeout&&(n=e.ads.settings.prerollTimeout),this._timeout=e.setTimeout(function(){e.trigger("adtimeout")},n),t?this.handleAdsReady():this.adsReady=!1},t.prototype.onAdsReady=function(e){e.ads.inAdBreak()||e.ads.isContentResuming()?f.log.warn("Unexpected adsready event (Preroll)"):(e.ads.debug("Received adsready event (Preroll)"),this.handleAdsReady())},t.prototype.handleAdsReady=function(){this.adsReady=!0,this.player.ads.nopreroll_?this.noPreroll():this.readyForPreroll()},t.prototype.afterLoadStart=function(e){var t=this.player;t.ads._hasThereBeenALoadStartDuringPlayerLife?e():(t.ads.debug("Waiting for loadstart..."),t.one("loadstart",function(){t.ads.debug("Received loadstart event"),e()}))},t.prototype.noPreroll=function(){var e=this;this.afterLoadStart(function(){e.player.ads.debug("Skipping prerolls due to nopreroll event (Preroll)"),e.transitionTo(R)})},t.prototype.readyForPreroll=function(){var e=this.player;this.afterLoadStart(function(){e.ads.debug("Triggered readyforpreroll event (Preroll)"),e.trigger("readyforpreroll")})},t.prototype.onPlay=function(e){e.ads.debug("Received play event (Preroll)"),this.inAdBreak()||this.isContentResuming()||b(this.player)},t.prototype.onAdsCanceled=function(e){var t=this;e.ads.debug("adscanceled (Preroll)"),this.afterLoadStart(function(){t.transitionTo(R)})},t.prototype.onAdsError=function(e){var t=this;f.log("adserror (Preroll)"),this.inAdBreak()&&e.ads.endLinearAdMode(),this.afterLoadStart(function(){t.transitionTo(R)})},t.prototype.startLinearAdMode=function(){var e=this.player;!this.adsReady||e.ads.inAdBreak()||this.isContentResuming()?f.log.warn("Unexpected startLinearAdMode invocation (Preroll)"):(e.clearTimeout(this._timeout),e.ads.adType="preroll",k.start(e))},t.prototype.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},t.prototype.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(e.removeClass("vjs-ad-loading"),k.end(e),this.contentResuming=!0)},t.prototype.skipLinearAdMode=function(){var e=this,t=this.player;t.ads.inAdBreak()||this.isContentResuming()?f.log.warn("Unexpected skipLinearAdMode invocation"):this.afterLoadStart(function(){t.trigger("adskip"),t.ads.debug("skipLinearAdMode (Preroll)"),e.transitionTo(R)})},t.prototype.onAdTimeout=function(e){var t=this;this.afterLoadStart(function(){e.ads.debug("adtimeout (Preroll)"),t.transitionTo(R)})},t.prototype.onNoPreroll=function(e){e.ads.inAdBreak()||this.isContentResuming()?f.log.warn("Unexpected nopreroll event (Preroll)"):this.noPreroll()},t.prototype.cleanup=function(){var e=this.player;e.ads._hasThereBeenALoadStartDuringPlayerLife||f.log.warn("Leaving Preroll state before loadstart event can cause issues."),e.removeClass("vjs-ad-loading"),e.clearTimeout(this._timeout)},t}(_),C=function(e){function t(){return s(this,t),y(this,e.apply(this,arguments))}return h(t,e),t._getName=function(){return"Midroll"},t.prototype.init=function(e){e.ads.adType="midroll",k.start(e)},t.prototype.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(this.contentResuming=!0,k.end(e))},t.prototype.onAdsError=function(e){this.inAdBreak()&&e.ads.endLinearAdMode()},t}(_),P=function(e){function t(){return s(this,t),y(this,e.apply(this,arguments))}return h(t,e),t._getName=function(){return"Postroll"},t.prototype.init=function(e){if(e.ads._contentEnding=!0,e.ads.nopostroll_)this.contentResuming=!0,this.transitionTo(w);else{e.addClass("vjs-ad-loading");var t=e.ads.settings.timeout;"number"==typeof e.ads.settings.postrollTimeout&&(t=e.ads.settings.postrollTimeout),this._postrollTimeout=e.setTimeout(function(){e.trigger("adtimeout")},t)}},t.prototype.startLinearAdMode=function(){var e=this.player;e.ads.inAdBreak()||this.isContentResuming()?f.log.warn("Unexpected startLinearAdMode invocation (Postroll)"):(e.ads.adType="postroll",e.clearTimeout(this._postrollTimeout),k.start(e))},t.prototype.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},t.prototype.endLinearAdMode=function(){var e=this,t=this.player;this.inAdBreak()&&(t.removeClass("vjs-ad-loading"),this.contentResuming=!0,k.end(t,function(){e.transitionTo(w)}))},t.prototype.skipLinearAdMode=function(){var e=this.player;e.ads.inAdBreak()||this.isContentResuming()?f.log.warn("Unexpected skipLinearAdMode invocation"):(e.ads.debug("Postroll abort (skipLinearAdMode)"),e.trigger("adskip"),this.abort())},t.prototype.onAdTimeout=function(e){e.ads.debug("Postroll abort (adtimeout)"),this.abort()},t.prototype.onAdsError=function(e){e.ads.debug("Postroll abort (adserror)"),e.ads.inAdBreak()?e.ads.endLinearAdMode():this.abort()},t.prototype.onContentChanged=function(e){this.isContentResuming()?this.transitionTo(L):this.inAdBreak()||this.transitionTo(S)},t.prototype.onNoPostroll=function(e){this.isContentResuming()||this.inAdBreak()?f.log.warn("Unexpected nopostroll event (Postroll)"):this.transitionTo(w)},t.prototype.abort=function(){var e=this.player;this.contentResuming=!0,e.removeClass("vjs-ad-loading"),this.transitionTo(w)},t.prototype.cleanup=function(){var e=this.player;e.clearTimeout(this._postrollTimeout),e.ads._contentEnding=!1},t}(_),L=function(e){function t(){return s(this,t),y(this,e.apply(this,arguments))}return h(t,e),t._getName=function(){return"BeforePreroll"},t.prototype.init=function(e){this.adsReady=!1},t.prototype.onAdsReady=function(e){e.ads.debug("Received adsready event (BeforePreroll)"),this.adsReady=!0},t.prototype.onPlay=function(e){e.ads.debug("Received play event (BeforePreroll)"),b(e),this.transitionTo(S,this.adsReady)},t.prototype.onAdsCanceled=function(e){e.ads.debug("adscanceled (BeforePreroll)"),this.transitionTo(R)},t.prototype.onAdsError=function(){this.transitionTo(R)},t.prototype.onNoPreroll=function(){this.player.ads.debug("Skipping prerolls due to nopreroll event (BeforePreroll)"),this.transitionTo(R)},t.prototype.skipLinearAdMode=function(){this.player.trigger("adskip"),this.transitionTo(R)},t.prototype.onContentChanged=function(){},t}(T),R=function(e){function t(){return s(this,t),y(this,e.apply(this,arguments))}return h(t,e),t._getName=function(){return"ContentPlayback"},t.prototype.init=function(e){e.paused()&&(e.ads._cancelledPlay||e.ads._pausedOnContentupdate)&&e.play()},t.prototype.onAdsReady=function(e){e.ads.debug("Received adsready event (ContentPlayback)"),e.ads.nopreroll_||(e.ads.debug("Triggered readyforpreroll event (ContentPlayback)"),e.trigger("readyforpreroll"))},t.prototype.onContentEnded=function(e){e.ads.debug("Received contentended event"),this.transitionTo(P)},t.prototype.startLinearAdMode=function(){this.transitionTo(C)},t}(T),w=function(e){function t(){return s(this,t),y(this,e.apply(this,arguments))}return h(t,e),t._getName=function(){return"AdsDone"},t.prototype.init=function(e){e.ads._contentHasEnded=!0,e.trigger("ended")},t.prototype.startLinearAdMode=function(){f.log.warn("Unexpected startLinearAdMode invocation (AdsDone)")},t}(T),M=f.getTech("Html5").Events,B={timeout:5e3,prerollTimeout:void 0,postrollTimeout:void 0,debug:!1,stitchedAds:!1},E=function(e){var t,o=this,n=f.mergeOptions(B,e),a=M.concat(["firstplay","loadedalldata","playing"]);o.on(a,i),o.setTimeout(function(){o.ads._hasThereBeenALoadStartDuringPlayerLife||""===o.src()||f.log.error("videojs-contrib-ads has not seen a loadstart event 5 seconds after being initialized, but a source is present. This indicates that videojs-contrib-ads was initialized too late. It must be initialized immediately after video.js in the same tick. As a result, some ads will not play and some media events will be incorrect. For more information, see https://github.com/videojs/videojs-contrib-ads#important-note-about-initialization")},5e3),o.on("ended",function(){o.hasClass("vjs-has-started")||o.addClass("vjs-has-started")}),o.on(["addurationchange","adcanplay"],function(){o.ads.snapshot&&o.currentSrc()===o.ads.snapshot.currentSrc||o.ads.inAdBreak()&&o.play()}),o.on("nopreroll",function(){o.ads.debug("Received nopreroll event"),o.ads.nopreroll_=!0}),o.on("nopostroll",function(){o.ads.debug("Received nopostroll event"),o.ads.nopostroll_=!0}),o.on("playing",function(){o.ads._cancelledPlay=!1,o.ads._pausedOnContentupdate=!1}),o.one("loadstart",function(){o.ads._hasThereBeenALoadStartDuringPlayerLife=!0}),o.on("loadeddata",function(){o.ads._hasThereBeenALoadedData=!0}),o.on("loadedmetadata",function(){o.ads._hasThereBeenALoadedMetaData=!0}),o.ads={settings:n,disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,adType:null,VERSION:"__VERSION__",reset:function(){o.ads.disableNextSnapshotRestore=!1,o.ads._contentEnding=!1,o.ads._contentHasEnded=!1,o.ads.snapshot=null,o.ads.adType=null,o.ads._hasThereBeenALoadedData=!1,o.ads._hasThereBeenALoadedMetaData=!1,o.ads._cancelledPlay=!1,o.ads.nopreroll_=!1,o.ads.nopostroll_=!1},startLinearAdMode:function(){o.ads._state.startLinearAdMode()},endLinearAdMode:function(){o.ads._state.endLinearAdMode()},skipLinearAdMode:function(){o.ads._state.skipLinearAdMode()},stitchedAds:function(e){return void 0!==e&&(this._stitchedAds=!!e),this._stitchedAds},videoElementRecycled:function(){if(o.ads.shouldPlayContentBehindAd(o))return!1;if(!this.snapshot)throw new Error("You cannot use videoElementRecycled while there is no snapshot.");var e=o.tech_.src()!==this.snapshot.src,t=o.currentSrc()!==this.snapshot.currentSrc;return e||t},isLive:function(e){return e.duration()===1/0||"8"===f.browser.IOS_VERSION&&0===e.duration()},shouldPlayContentBehindAd:function(e){return!f.browser.IS_IOS&&!f.browser.IS_ANDROID&&e.duration()===1/0},isInAdMode:function(){return this._state.isAdState()},isContentResuming:function(){return this._state.isContentResuming()},isAdPlaying:function(){return this._state.inAdBreak()},inAdBreak:function(){return this._state.inAdBreak()},removeNativePoster:function(){var e=o.$(".vjs-tech");e&&e.removeAttribute("poster")},debug:function(){if(this.settings.debug){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];1===t.length&&"string"==typeof t[0]?f.log("ADS: "+t[0]):f.log.apply(f,["ADS:"].concat(t))}}},o.ads._state=new L(o),o.ads.stitchedAds(n.stitchedAds),o.ads.cueTextTracks=v,o.ads.adMacroReplacement=function(e,s,t){void 0===s&&(s=!1);var n={};for(var o in void 0!==t&&(n=t),n["{player.id}"]=this.options_["data-player"],n["{mediainfo.id}"]=this.mediainfo?this.mediainfo.id:"",n["{mediainfo.name}"]=this.mediainfo?this.mediainfo.name:"",n["{mediainfo.description}"]=this.mediainfo?this.mediainfo.description:"",n["{mediainfo.tags}"]=this.mediainfo?this.mediainfo.tags:"",n["{mediainfo.reference_id}"]=this.mediainfo?this.mediainfo.reference_id:"",n["{mediainfo.duration}"]=this.mediainfo?this.mediainfo.duration:"",n["{mediainfo.ad_keys}"]=this.mediainfo?this.mediainfo.ad_keys:"",n["{player.duration}"]=this.duration(),n["{timestamp}"]=(new Date).getTime(),n["{document.referrer}"]=c.referrer,n["{window.location.href}"]=l.location.href,n["{random}"]=Math.floor(1e12*Math.random()),m(this.mediainfo,n,"custom_fields"),m(this.mediainfo,n,"customFields"),n)e=e.split(o).join(g(n[o],s));return e=e.replace(/{pageVariable\.([^}]+)}/g,function(e,t){for(var n=void 0,o=l,a=t.split("."),r=0;r<a.length;r++)r===a.length-1?n=o[a[r]]:o=o[a[r]];var i=void 0===n?"undefined":p(n);return null===n?"null":void 0===n?(f.log.warn('Page variable "'+t+'" not found'),""):"string"!==i&&"number"!==i&&"boolean"!==i?(f.log.warn('Page variable "'+t+'" is not a supported type'),""):g(String(n),s)})}.bind(o),(t=o).ads.contentSrc=t.currentSrc(),t.ads._seenInitialLoadstart=!1,t.on("loadstart",function(){if(!t.ads.inAdBreak()){var e=t.currentSrc();e!==t.ads.contentSrc&&(t.ads._seenInitialLoadstart&&t.trigger({type:"contentchanged"}),t.trigger({type:"contentupdate",oldValue:t.ads.contentSrc,newValue:e}),t.ads.contentSrc=e),t.ads._seenInitialLoadstart=!0}}),o.on("contentchanged",o.ads.reset);var r=function(){var e=o.textTracks();if(!o.ads.shouldPlayContentBehindAd(o)&&o.ads.inAdBreak()&&o.tech_.featuresNativeTextTracks&&f.browser.IS_IOS&&!Array.isArray(o.textTracks()))for(var t=0;t<e.length;t++){var n=e[t];"showing"===n.mode&&(n.mode="disabled")}};o.ready(function(){o.textTracks().addEventListener("change",r)}),o.on(["play","playing","ended","adsready","adscanceled","adskip","adserror","adtimeout","ads-ad-started","contentchanged","contentresumed","contentended","nopreroll","nopostroll"],function(e){o.ads._state.handleEvent(e.type)}),o.on("dispose",function(){o.textTracks().removeEventListener("change",r)})};return(f.registerPlugin||f.plugin)("ads",E),E});