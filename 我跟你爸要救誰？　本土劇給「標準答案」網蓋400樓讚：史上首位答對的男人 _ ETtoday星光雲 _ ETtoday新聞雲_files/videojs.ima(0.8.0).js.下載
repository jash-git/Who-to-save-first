!function(e){if("function"==typeof define&&define.amd)define(["video.js","videojs-contrib-ads"],function(t){e(window,document,t)});else if("object"==typeof exports&&"object"==typeof module){var t=require("video.js");require("videojs-contrib-ads"),e(window,document,t)}else e(window,document,videojs)}(function(U,x,t){"use strict";t=t.default||t;var q=function(t){var e,i,s;for(i=1;i<arguments.length;i++)for(s in e=arguments[i])e.hasOwnProperty(s)&&(t[s]=e[s]);return t},G={debug:!1,timeout:5e3,prerollTimeout:100,adLabel:"Advertisement",showControlsForJSAds:!0},i=function(t,e,i){this.player=t;var s=function(t,e){t.id=this.controlPrefix+e,t.className=this.controlPrefix+e+" "+e}.bind(this),n=function(t){return new RegExp("(^|[^A-Za-z-])"+t+"((?![A-Za-z-])|$)","gi")},a=function(t,e){return n(e).test(t.className)?t:t.className=t.className.trim()+" "+e},d=function(t,e){var i=n(e);return i.test(t.className)?t.className=t.className.trim().replace(i,""):t},r=function(){this.vjsControls=this.player.getChild("controlBar"),this.adContainerDiv=this.vjsControls.el().parentNode.appendChild(x.createElement("div")),s(this.adContainerDiv,"ima-ad-container"),this.adContainerDiv.style.position="absolute",this.adContainerDiv.style.zIndex=1111,this.adContainerDiv.addEventListener("mouseenter",f,!1),this.adContainerDiv.addEventListener("mouseleave",A,!1),h(),this.adDisplayContainer=new google.ima.AdDisplayContainer(this.adContainerDiv,this.contentPlayer)}.bind(this),h=function(){this.controlsDiv=x.createElement("div"),s(this.controlsDiv,"ima-controls-div"),this.controlsDiv.style.width="100%",this.countdownDiv=x.createElement("div"),s(this.countdownDiv,"ima-countdown-div"),this.countdownDiv.innerHTML=this.settings.adLabel,this.countdownDiv.style.display=this.showCountdown?"block":"none",this.seekBarDiv=x.createElement("div"),s(this.seekBarDiv,"ima-seek-bar-div"),this.seekBarDiv.style.width="100%",this.progressDiv=x.createElement("div"),s(this.progressDiv,"ima-progress-div"),this.playPauseDiv=x.createElement("div"),s(this.playPauseDiv,"ima-play-pause-div"),a(this.playPauseDiv,"ima-playing"),this.playPauseDiv.addEventListener("click",L,!1),this.muteDiv=x.createElement("div"),s(this.muteDiv,"ima-mute-div"),a(this.muteDiv,"ima-non-muted"),this.muteDiv.addEventListener("click",P,!1),this.sliderDiv=x.createElement("div"),s(this.sliderDiv,"ima-slider-div"),this.sliderDiv.addEventListener("mousedown",M,!1),this.sliderLevelDiv=x.createElement("div"),s(this.sliderLevelDiv,"ima-slider-level-div"),this.fullscreenDiv=x.createElement("div"),s(this.fullscreenDiv,"ima-fullscreen-div"),a(this.fullscreenDiv,"ima-non-fullscreen"),this.fullscreenDiv.addEventListener("click",w,!1),this.adContainerDiv.appendChild(this.controlsDiv),this.controlsDiv.appendChild(this.countdownDiv),this.controlsDiv.appendChild(this.seekBarDiv),this.controlsDiv.appendChild(this.playPauseDiv),this.controlsDiv.appendChild(this.muteDiv),this.controlsDiv.appendChild(this.sliderDiv),this.controlsDiv.appendChild(this.fullscreenDiv),this.seekBarDiv.appendChild(this.progressDiv),this.sliderDiv.appendChild(this.sliderLevelDiv)}.bind(this);this.initializeAdDisplayContainer=function(){this.adDisplayContainerInitialized=!0,this.adDisplayContainer.initialize()}.bind(this),this.requestAds=function(){this.adDisplayContainerInitialized||this.adDisplayContainer.initialize();var t=new google.ima.AdsRequest;this.settings.adTagUrl?t.adTagUrl=this.settings.adTagUrl:t.adsResponse=this.settings.adsResponse,this.settings.forceNonLinearFullSlot&&(t.forceNonLinearFullSlot=!0),t.linearAdSlotWidth=this.getPlayerWidth(),t.linearAdSlotHeight=this.getPlayerHeight(),t.nonLinearAdSlotWidth=this.settings.nonLinearWidth||this.getPlayerWidth(),t.nonLinearAdSlotHeight=this.settings.nonLinearHeight||this.getPlayerHeight()/3,t.setAdWillAutoPlay(this.settings.adWillAutoPlay),this.adsLoader.requestAds(t)}.bind(this);var o=function(t){if(this.adsManager=t.getAdsManager(this.contentPlayheadTracker,this.adsRenderingSettings),this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,c),this.adsManager.addEventListener(google.ima.AdEvent.Type.AD_BREAK_READY,g),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequested_),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequested_),this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,u),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,v),this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,m),this.adsManager.addEventListener(google.ima.AdEvent.Type.CLICK,L),this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdComplete_),this.adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED,this.onAdComplete_),this.isMobile&&(this.adsManager.addEventListener(google.ima.AdEvent.Type.PAUSED,y),this.adsManager.addEventListener(google.ima.AdEvent.Type.RESUMED,p)),!this.autoPlayAdBreaks)try{var e=this.getPlayerWidth(),i=this.getPlayerHeight();this.adsManagerDimensions.width=e,this.adsManagerDimensions.height=i,this.adsManager.init(e,i,google.ima.ViewMode.NORMAL),this.adsManager.setVolume(this.player.muted()?0:this.player.volume())}catch(t){c(t)}this.player.trigger("adsready")}.bind(this);this.start=function(){U.console.log("WARNING: player.ima.start is deprecated. Use player.ima.startFromReadyCallback instead.")},this.startFromReadyCallback=function(){if(this.autoPlayAdBreaks)try{this.adsManager.init(this.getPlayerWidth(),this.getPlayerHeight(),google.ima.ViewMode.NORMAL),this.adsManager.setVolume(this.player.muted()?0:this.player.volume()),this.adsManager.start()}catch(t){c(t)}}.bind(this);var l=function(t){U.console.log("AdsLoader error: "+t.getError()),this.adContainerDiv.style.display="none",this.adsManager&&this.adsManager.destroy(),this.player.trigger({type:"adserror",data:{AdError:t.getError(),AdErrorEvent:t}})}.bind(this),c=function(t){var e=void 0!==t.getError?t.getError():t.stack;U.console.log("Ad error: "+e),this.vjsControls.show(),this.adsManager.destroy(),this.adContainerDiv.style.display="none",this.player.trigger({type:"adserror",data:{AdError:e,AdErrorEvent:t}})}.bind(this),g=function(t){this.adBreakReadyListener(t)}.bind(this);this.playAdBreak=function(){this.autoPlayAdBreaks||this.adsManager.start()}.bind(this),this.onContentPauseRequested_=function(t){this.adsActive=!0,this.adPlaying=!0,this.contentSource=this.player.currentSrc(),this.contentSourceType=this.player.currentType(),this.player.off("ended",this.localContentEndedListener),-1!=t.getAd().getAdPodInfo().getPodIndex()&&this.player.ads.startLinearAdMode(),this.adContainerDiv.style.display="block","application/javascript"!==t.getAd().getContentType()||this.settings.showControlsForJSAds?this.controlsDiv.style.display="block":this.controlsDiv.style.display="none",this.vjsControls.hide(),E(),this.player.pause(),A()}.bind(this),this.onContentResumeRequested_=function(t){this.adsActive=!1,this.adPlaying=!1,this.player.on("ended",this.localContentEndedListener),(null==this.currentAd||this.currentAd.isLinear())&&(this.adContainerDiv.style.display="none"),this.vjsControls.show(),this.currentAd&&(this.contentComplete||-1==this.currentAd.getAdPodInfo().getPodIndex())||this.player.ads.endLinearAdMode(),this.controlsDiv.style.display="none",this.countdownDiv.innerHTML=""}.bind(this);var u=function(t){if(this.allAdsCompleted=!0,this.adContainerDiv.style.display="none",1==this.contentComplete)for(var e in this.contentPlayer.src!=this.contentSource&&(this.player.autoplay(!1),this.player.src({src:this.contentSource,type:this.contentSourceType})),this.contentAndAdsEndedListeners)this.contentAndAdsEndedListeners[e]()}.bind(this),v=function(t){t.getAd().isLinear()||this.player.play()}.bind(this),m=function(t){this.currentAd=t.getAd(),this.currentAd.isLinear()?(this.adTrackingTimer=setInterval(D,250),d(this.adContainerDiv,"bumpable-ima-ad-container")):a(this.adContainerDiv,"bumpable-ima-ad-container"),this.adContainerDiv.style.display="block",this.player.trigger("ads-ad-started")}.bind(this),y=function(t){C(),f(),this.adPlaying=!1}.bind(this),p=function(t){E(),A(),this.adPlaying=!0}.bind(this);this.onAdComplete_=function(t){this.currentAd.isLinear()&&clearInterval(this.adTrackingTimer)}.bind(this);var D=function(){var t=this.adsManager.getRemainingTime(),e=this.currentAd.getDuration(),i=e-t;i=0<i?i:0;var s,n=!1,a=0;this.currentAd.getAdPodInfo()&&(n=!0,s=this.currentAd.getAdPodInfo().getAdPosition(),a=this.currentAd.getAdPodInfo().getTotalAds());var d=Math.floor(t/60),r=Math.floor(t%60);r.toString().length<2&&(r="0"+r);var h=": ";n&&1<a&&(h=" ("+s+" of "+a+"): "),this.countdownDiv.innerHTML=this.settings.adLabel+h+d+":"+r;var o=100*(i/e);this.progressDiv.style.width=o+"%"}.bind(this);this.getPlayerWidth=function(){var t=this.player.el().getBoundingClientRect()||{};return parseInt(t.width,10)||this.player.width()}.bind(this),this.getPlayerHeight=function(){var t=this.player.el().getBoundingClientRect()||{};return parseInt(t.height,10)||this.player.height()}.bind(this);var A=function(){this.controlsDiv.style.height="14px",this.playPauseDiv.style.display="none",this.muteDiv.style.display="none",this.sliderDiv.style.display="none",this.fullscreenDiv.style.display="none"}.bind(this),f=function(){this.controlsDiv.style.height="37px",this.playPauseDiv.style.display="block",this.muteDiv.style.display="block",this.sliderDiv.style.display="block",this.fullscreenDiv.style.display="block"}.bind(this),C=function(){a(this.playPauseDiv,"ima-paused"),d(this.playPauseDiv,"ima-playing")}.bind(this),E=function(){a(this.playPauseDiv,"ima-playing"),d(this.playPauseDiv,"ima-paused")}.bind(this),L=function(){this.adPlaying?(C(),this.adsManager.pause(),this.adPlaying=!1):(E(),this.adsManager.resume(),this.adPlaying=!0)}.bind(this),P=function(){this.adMuted?(a(this.muteDiv,"ima-non-muted"),d(this.muteDiv,"ima-muted"),this.adsManager.setVolume(1),this.player.muted(!1),this.adMuted=!1,this.sliderLevelDiv.style.width=100*this.player.volume()+"%"):(a(this.muteDiv,"ima-muted"),d(this.muteDiv,"ima-non-muted"),this.adsManager.setVolume(0),this.player.muted(!0),this.adMuted=!0,this.sliderLevelDiv.style.width="0%")}.bind(this),M=function(){x.addEventListener("mouseup",T,!1),x.addEventListener("mousemove",b,!1)},b=function(t){k(t)},T=function(t){k(t),x.removeEventListener("mousemove",b),x.removeEventListener("mouseup",T)},k=function(t){var e=(t.clientX-this.sliderDiv.getBoundingClientRect().left)/this.sliderDiv.offsetWidth;e*=100,e=Math.min(Math.max(e,0),100),this.sliderLevelDiv.style.width=e+"%",this.player.volume(e/100),this.adsManager.setVolume(e/100),0==this.player.volume()?(a(this.muteDiv,"ima-muted"),d(this.muteDiv,"ima-non-muted"),this.player.muted(!0),this.adMuted=!0):(a(this.muteDiv,"ima-non-muted"),d(this.muteDiv,"ima-muted"),this.player.muted(!1),this.adMuted=!1)}.bind(this),w=function(){this.player.isFullscreen()?this.player.exitFullscreen():this.player.requestFullscreen()}.bind(this),R=function(){this.player.isFullscreen()?(a(this.fullscreenDiv,"ima-fullscreen"),d(this.fullscreenDiv,"ima-non-fullscreen"),this.adsManager&&this.adsManager.resize(U.screen.width,U.screen.height,google.ima.ViewMode.FULLSCREEN)):(a(this.fullscreenDiv,"ima-non-fullscreen"),d(this.fullscreenDiv,"ima-fullscreen"),this.adsManager&&this.adsManager.resize(this.getPlayerWidth(),this.getPlayerHeight(),google.ima.ViewMode.NORMAL))}.bind(this),S=function(){var t=this.player.muted()?0:this.player.volume();this.adsManager&&this.adsManager.setVolume(t),0==t?(this.adMuted=!0,a(this.muteDiv,"ima-muted"),d(this.muteDiv,"ima-non-muted"),this.sliderLevelDiv.style.width="0%"):(this.adMuted=!1,a(this.muteDiv,"ima-non-muted"),d(this.muteDiv,"ima-muted"),this.sliderLevelDiv.style.width=100*t+"%")}.bind(this),I=function(){this.player.off("loadedmetadata",I),this.player.currentTime(0)}.bind(this),B=function(){this.player.off("loadedmetadata",B),this.player.currentTime(0),this.player.play()}.bind(this),N=function(){this.adsActive=!1,this.adPlaying=!1,this.player.on("ended",this.localContentEndedListener),this.vjsControls.show(),this.player.ads.endLinearAdMode(),this.adTrackingTimer&&clearInterval(this.adTrackingTimer),this.contentPlayheadTracker.currentTime=0,this.adsManager&&(this.adsManager.destroy(),this.adsManager=null),this.adsLoader&&!this.contentComplete&&this.adsLoader.contentComplete(),this.contentComplete=!1,this.allAdsCompleted=!1}.bind(this);this.addEventListener=function(t,e){this.adsManager&&this.adsManager.addEventListener(t,e)}.bind(this),this.getAdsManager=function(){return this.adsManager}.bind(this),this.setContent=function(t,e,i){U.console.log("WARNING: player.ima.setContent is deprecated. Use player.ima.setContentWithAdTag instead."),this.setContentWithAdTag(t,e,i)}.bind(this),this.setContentWithAdTag=function(t,e,i){N(),this.settings.adTagUrl=e||this.settings.adTagUrl,H(t,i)}.bind(this),this.setContentWithAdsResponse=function(t,e,i){N(),this.settings.adsResponse=e||this.settings.adsResponse,H(t,i)}.bind(this),this.changeAdTag=function(t){N(),this.settings.adTagUrl=t}.bind(this);var H=function(t,e){this.player.currentSrc()&&(this.player.currentTime(0),this.player.pause()),t&&this.player.src(t),e?this.player.on("loadedmetadata",B):this.player.on("loadedmetadata",I)}.bind(this);this.addContentEndedListener=function(t){this.contentEndedListeners.push(t)}.bind(this),this.addContentAndAdsEndedListener=function(t){this.contentAndAdsEndedListeners.push(t)}.bind(this),this.setAdBreakReadyListener=function(t){this.adBreakReadyListener=t}.bind(this),this.pauseAd=function(){this.adsActive&&this.adPlaying&&(C(),this.adsManager.pause(),this.adPlaying=!1)}.bind(this),this.resumeAd=function(){this.adsActive&&!this.adPlaying&&(E(),this.adsManager.resume(),this.adPlaying=!0)}.bind(this);var W=function(){this.updateTimeIntervalHandle=setInterval(_,this.seekCheckInterval),this.seekCheckIntervalHandle=setInterval(O,this.seekCheckInterval),this.resizeCheckIntervalHandle=setInterval(V,this.resizeCheckInterval)}.bind(this),_=function(){this.contentPlayheadTracker.seeking||(this.contentPlayheadTracker.currentTime=this.player.currentTime())}.bind(this),O=function(){var t=1e3*(this.player.currentTime()-this.contentPlayheadTracker.previousTime);Math.abs(t)>this.seekCheckInterval+this.seekThreshold?this.contentPlayheadTracker.seeking=!0:this.contentPlayheadTracker.seeking=!1,this.contentPlayheadTracker.previousTime=this.player.currentTime()}.bind(this),V=function(){var t=this.getPlayerWidth(),e=this.getPlayerHeight();!this.adsManager||t==this.adsManagerDimensions.width&&e==this.adsManagerDimensions.height||(this.adsManagerDimensions.width=t,this.adsManagerDimensions.height=e,this.adsManager.resize(t,e,google.ima.ViewMode.NORMAL))}.bind(this);if(this.setShowCountdown=function(t){this.showCountdown=t,this.countdownDiv.style.display=this.showCountdown?"block":"none"}.bind(this),this.VERSION="0.7.0",this.settings,this.controlPrefix,this.contentPlayer,this.showCountdown,this.autoPlayAdBreaks,this.vjsControls,this.adContainerDiv,this.controlsDiv,this.countdownDiv,this.seekBarDiv,this.progressDiv,this.playPauseDiv,this.muteDiv,this.sliderDiv,this.sliderLevelDiv,this.fullscreenDiv,this.adDisplayContainer,this.adDisplayContainerInitialized=!1,this.adsLoader,this.adsManager,this.adsRenderingSettings=null,this.adTagUrl,this.adsResponse,this.currentAd,this.contentTrackingTimer,this.adTrackingTimer,this.adsActive=!1,this.adPlaying=!1,this.adMuted=!1,this.contentComplete=!1,this.allAdsCompleted=!1,this.updateTimeIntervalHandle,this.seekCheckIntervalHandle,this.seekCheckInterval=1e3,this.resizeCheckIntervalHandle,this.resizeCheckInterval=250,this.seekThreshold=100,this.isMobile=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i),this.contentPlayheadTracker={currentTime:0,previousTime:0,seeking:!1,duration:0},this.adPlayheadTracker={currentTime:0,duration:0,isPod:!1,adPosition:0,totalAds:0},this.adsManagerDimensions={width:0,height:0},this.contentEndedListeners=[],this.contentAndAdsEndedListeners=[],this.adBreakReadyListener=void 0,this.contentSource="",this.contentSourceType="",this.localContentEndedListener=function(){for(var t in this.adsLoader&&!this.contentComplete&&(this.adsLoader.contentComplete(),this.contentComplete=!0),this.contentEndedListeners)this.contentEndedListeners[t]();if(this.allAdsCompleted)for(var t in this.contentAndAdsEndedListeners)this.contentAndAdsEndedListeners[t]();clearInterval(this.updateTimeIntervalHandle),clearInterval(this.seekCheckIntervalHandle),clearInterval(this.resizeCheckIntervalHandle),this.player.el()&&this.player.one("play",W)}.bind(this),this.playerDisposedListener=function(){this.contentEndedListeners=[],this.contentAndAdsEndedListeners=[],this.contentComplete=!0,this.player.off("ended",this.localContentEndedListener),this.player.ads.adTimeoutTimeout&&clearTimeout(this.player.ads.adTimeoutTimeout);var t=[this.updateTimeIntervalHandle,this.seekCheckIntervalHandle,this.adTrackingTimer,this.resizeCheckIntervalHandle];for(var e in t){var i=t[e];i&&clearInterval(i)}this.adsManager&&(this.adsManager.destroy(),this.adsManager=null)}.bind(this),this.settings=q({},G,e||{}),this.settings.id){this.controlPrefix=this.settings.id+"_"||"",this.contentPlayer=x.getElementById(this.settings.id).getElementsByClassName("vjs-tech")[0],this.contentPlayer.hasAttribute("autoplay")&&(this.settings.adWillAutoPlay=this.settings.adWillAutoPlay||!0),this.showCountdown=!0,0==this.settings.showCountdown&&(this.showCountdown=!1),this.autoPlayAdBreaks=!0,0==this.settings.autoPlayAdBreaks&&(this.autoPlayAdBreaks=!1),t.one("play",W),t.on("ended",this.localContentEndedListener),t.on("dispose",this.playerDisposedListener);var j={debug:this.settings.debug,timeout:this.settings.timeout,prerollTimeout:this.settings.prerollTimeout},z=q({},j,e.contribAdsSettings||{});if(t.ads(z),this.adsRenderingSettings=new google.ima.AdsRenderingSettings,this.adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete=!0,this.settings.adsRenderingSettings)for(var F in this.settings.adsRenderingSettings)this.adsRenderingSettings[F]=this.settings.adsRenderingSettings[F];this.settings.locale&&google.ima.settings.setLocale(this.settings.locale),this.settings.disableFlashAds&&google.ima.settings.setDisableFlashAds(this.settings.disableFlashAds),this.settings.disableCustomPlaybackForIOS10Plus&&google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.settings.disableCustomPlaybackForIOS10Plus),r(),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),0==this.settings.vpaidAllowed&&this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.DISABLED),this.settings.vpaidMode&&this.adsLoader.getSettings().setVpaidMode(this.settings.vpaidMode),this.settings.locale&&this.adsLoader.getSettings().setLocale(this.settings.locale),this.settings.numRedirects&&this.adsLoader.getSettings().setNumRedirects(this.settings.numRedirects),this.adsLoader.getSettings().setPlayerType("videojs-ima"),this.adsLoader.getSettings().setPlayerVersion(this.VERSION),this.adsLoader.getSettings().setAutoPlayAdBreaks(this.autoPlayAdBreaks),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,o,!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,l,!1),i||(i=this.startFromReadyCallback),t.on("readyforpreroll",i),t.ready(function(){S(),t.on("fullscreenchange",R),t.on("volumechange",S)})}else U.console.log("Error: must provide id of video.js div")};(t.registerPlugin||t.plugin)("ima",function(t,e){this.ima=new i(this,t,e)})});